<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸Šä¼ æµ‹è¯•é¡µé¢</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eff6ff',
              100: '#dbeafe',
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #3b82f6, #2563eb);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #60a5fa, #3b82f6);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 p-6 font-sans">
  <div class="max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ”§ ä¸Šä¼ åŠŸèƒ½è¯Šæ–­é¡µé¢</h1>

    <div id="uploadArea" class="border-3 border-dashed border-blue-400 bg-white rounded-2xl p-12 text-center cursor-pointer transition-all duration-300 hover:bg-blue-50 hover:border-blue-500 hover:shadow-lg mb-6">
      <h2 class="text-2xl font-semibold text-gray-700 mb-2">ğŸ“¤ ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</h2>
      <p class="text-gray-500">æ”¯æŒå›¾ç‰‡å’ŒPDFæ–‡ä»¶</p>
    </div>

    <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ“‹ æ§åˆ¶å°æ—¥å¿—:</h3>
    <div id="console" class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm h-96 overflow-y-auto shadow-xl"></div>
  </div>

  <script>
    const consoleDiv = document.getElementById('console');
    const uploadArea = document.getElementById('uploadArea');

    // è‡ªå®šä¹‰æ§åˆ¶å°
    function log(message, type = 'info') {
      const div = document.createElement('div');
      const colorClass = {
        'error': 'text-red-400',
        'success': 'text-green-400',
        'info': 'text-blue-400'
      }[type] || 'text-green-400';
      div.className = `my-1 ${colorClass}`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      consoleDiv.appendChild(div);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
      console.log(message);
    }

    log('é¡µé¢åŠ è½½å®Œæˆ', 'success');
    log('document.readyState: ' + document.readyState, 'info');

    // å®šä¹‰ä¸Šä¼ å¤„ç†å‡½æ•°
    window.handleUpload = function(file) {
      log(`å‡†å¤‡ä¸Šä¼ æ–‡ä»¶: ${file.name}, å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)}MB`, 'info');

      const formData = new FormData();
      formData.append("file", file);

      const isPdf = file.type.includes("pdf");
      const url = isPdf ? '/your-password-here/api/async/pdf' : '/your-password-here/api/async/image';

      log(`ä¸Šä¼ URL: ${url}`, 'info');
      log('å¼€å§‹ä¸Šä¼ ...', 'info');

      fetch(url, { method: "POST", body: formData })
        .then(response => {
          log(`æœåŠ¡å™¨å“åº”çŠ¶æ€: ${response.status}`, response.ok ? 'success' : 'error');
          return response.json();
        })
        .then(data => {
          log('æœåŠ¡å™¨å“åº”æ•°æ®: ' + JSON.stringify(data), 'success');
          if (data.status === "success") {
            log(`âœ“ ä¸Šä¼ æˆåŠŸ! ä»»åŠ¡ID: ${data.task_id}`, 'success');
          } else {
            log(`âœ— ä¸Šä¼ å¤±è´¥: ${data.message || data.detail}`, 'error');
          }
        })
        .catch(err => {
          log(`âœ— ä¸Šä¼ é”™è¯¯: ${err.message}`, 'error');
        });
    };

    // ç‚¹å‡»ä¸Šä¼ 
    uploadArea.addEventListener('click', function() {
      log('ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ', 'info');
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*,.pdf';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          log(`é€‰æ‹©æ–‡ä»¶: ${file.name}`, 'success');
          window.handleUpload(file);
        }
      };
      input.click();
    });

    // æ‹–æ‹½ä¸Šä¼ 
    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.classList.add('border-green-500', 'bg-green-50');
      uploadArea.classList.remove('border-blue-400');
    });

    uploadArea.addEventListener('dragleave', function(e) {
      uploadArea.classList.remove('border-green-500', 'bg-green-50');
      uploadArea.classList.add('border-blue-400');
    });

    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('border-green-500', 'bg-green-50');
      uploadArea.classList.add('border-blue-400');
      const file = e.dataTransfer.files[0];
      if (file) {
        log(`æ‹–æ”¾æ–‡ä»¶: ${file.name}`, 'success');
        window.handleUpload(file);
      }
    });

    log('äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š', 'success');
    log('ç­‰å¾…æ–‡ä»¶ä¸Šä¼ ...', 'info');
  </script>
</body>
</html>
